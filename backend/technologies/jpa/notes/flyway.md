# Flyway

## 개요
- 스키마 버전 관리를 위한 DB 마이그레이션 도구. `V1__init.sql` 처럼 버전이 붙은 스크립트를 순서대로 실행한다.
- JDBC 기반으로 다수의 DBMS를 지원하며, Spring Boot와 통합 시 애플리케이션 기동 시점에 자동 실행된다.

## 구성 요소
- **`flyway_schema_history`** 테이블: 실행된 마이그레이션의 버전, 상태, 체크섬을 저장.
- **마이그레이션 타입**: SQL 기반(`V`, `R`), Java 기반(`V` 클래스) 등.
- **Repeatable Migration (R)**: 체크섬이 변하면 다시 실행되어 뷰/스토어드 프로시저 관리에 적합.

## 모범 사례
- 스키마 변경은 모두 버전 스크립트로 관리하고, 수동 변경은 금지한다.
- DDL/DML을 분리하여 롤백 계획을 세운다 (예: `V2` 로 컬럼 추가, `V2_1` 로 데이터 백필).
- 다중 환경에서는 같은 Git SHA를 동일한 버전 이름으로 배포하여 재현성을 확보한다.
- 긴 쿼리는 transaction off + 배치 처리 전략을 문서화한다.

## 트러블슈팅
- 실패 시 `repair` 로 체크섬을 수정하기보다, 새로운 버전을 추가해 수정 사항을 적용한다.
- 수동으로 `flyway_schema_history` 를 수정해야 한다면 변경 내역을 운영 기록에 남긴다.
