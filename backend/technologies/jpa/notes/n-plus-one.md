# N+1 문제

## 정의
- 1개의 쿼리로 N개의 엔티티를 가져온 뒤, 각 엔티티의 연관 관계를 지연 로딩하면서 N개의 추가 쿼리가 실행되는 현상.
- 총 `1 + N` 건의 쿼리가 발생해 성능이 급격히 저하된다.

## 징후
- 로깅에서 동일 패턴의 SELECT 쿼리가 반복된다.
- 컬렉션/연관 엔티티 접근 시마다 DB round-trip 증가.

## 해결 전략
- **Fetch Join**: 필요한 연관 관계를 `join fetch` 로 한 번에 불러온다.
- **EntityGraph**: 특정 use case마다 그래프를 정의해 동적으로 페치 전략을 제어한다.
- **Batch Size**: `@BatchSize` 로 IN 절을 사용한 일괄 조회 처리.
- **DTO Projection**: 화면 전용 쿼리로 필요한 데이터만 조회해 엔티티 로딩 자체를 줄인다.
- **캐시**: 자주 참조되는 참조 데이터는 2차 캐시나 애플리케이션 캐시에 저장.

## 테스트
- JPA 쿼리 로그/Hibernate Statistics 를 켜서 단위 테스트에 쿼리 수 assertion을 두면 재발을 방지할 수 있다.
