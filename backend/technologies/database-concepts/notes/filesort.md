# Filesort

## 개념
- MySQL 옵티마이저가 인덱스로 정렬을 처리할 수 없을 때 사용하는 정렬 알고리즘. 실제 디스크 파일을 쓰지 않더라도 "filesort" 라고 부른다.

## 동작 방식
1. 조건에 맞는 행을 읽어 정렬 키와 추가 컬럼을 버퍼에 저장.
2. 메모리 버퍼가 가득 차면 임시 파일에 기록 후 병합 정렬을 수행.
3. 정렬된 결과를 클라이언트에 반환하거나 추가 조인을 수행.

## 문제점
- 대량 정렬 시 디스크 I/O 증가, 임시 테이블 생성으로 인해 성능 저하.
- `ORDER BY`와 `LIMIT` 조합에서도 filesort가 발생하면 응답 시간이 늘어난다.

## 최적화 전략
- 정렬 컬럼을 포함한 인덱스를 설계해 `Using index` + `Using where` 로 처리하도록 한다.
- `ORDER BY` 순서를 인덱스와 일치시키고, 혼합 ASC/DESC 가 필요한 경우 가능한 한 인덱스를 맞춘다.
- 필요 없는 컬럼은 SELECT에서 제외해 정렬 시 버퍼 사용량을 줄인다.
- `sort_buffer_size` 조정, InnoDB `innodb_sort_buffer_size` 등 파라미터 튜닝.
