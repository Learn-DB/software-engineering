# 동시성 이상 현상

동시 트랜잭션이 동시에 실행될 때 격리 수준이 충분하지 않으면 다음 문제가 발생한다.

## Dirty Read
- 커밋되지 않은 데이터를 다른 트랜잭션이 읽는 현상.
- 취소된 변경을 기반으로 추가 로직이 실행되면 롤백 이후 데이터 불일치가 발생한다.
- `Read Uncommitted` 에서 발생, 대부분의 상용 DB에서는 기본적으로 차단한다.

## Non-repeatable Read
- 같은 조건으로 여러 번 조회할 때 결과가 달라지는 현상.
- 다른 트랜잭션이 커밋한 변경을 읽게 되어 검증 로직이 깨질 수 있다.
- `Read Committed` 수준에서 허용되며, `Repeatable Read` 이상에서 방지된다.

## Phantom Read
- 트랜잭션 내 동일 조건 조회 시 레코드 수가 변하는 현상 (삽입/삭제로 인해 "유령" 행이 나타남).
- 범위 잠금이나 MVCC 스냅샷이 필요하며, `Serializable` 이나 MVCC 기반 `Repeatable Read` 에서 방지된다.

## Lost Update
- 두 트랜잭션이 동일 레코드를 읽고 각각 수정 후 커밋할 때 마지막 커밋이 첫 번째 변경을 덮어쓴다.
- 버전 컬럼(Optimistic Lock)이나 `SELECT ... FOR UPDATE` 같은 Pessimistic Lock을 사용해 방지한다.

## Write Skew
- 서로 다른 행을 수정하지만 제약 조건이 전체 집합에 적용되는 경우 발생한다 (예: 최소 한 명의 의사가 on-call 이어야 함).
- `Serializable` 격리 또는 애플리케이션 레벨 체크를 통해 회피한다.

## 진단/대응
- DB의 모니터링 뷰에서 격리 수준, 잠금 대기, 버전 스토어 사용량 등을 추적한다.
- 문제가 재현되는 스크립트를 작성해 테스트 환경에서 격리 수준별 동작을 확인한다.
- 비즈니스 루틴마다 필요한 격리 수준을 문서화하고 코드/ORM 설정으로 강제한다.
