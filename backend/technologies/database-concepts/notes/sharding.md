# 샤딩 (Sharding)

대용량 데이터와 트래픽을 여러 DB 인스턴스로 수평 분할하는 기법.

## 분할 전략
- **Range Sharding**: 키 범위(날짜, 사용자 ID 구간)에 따라 샤드에 배치. 구현 단순, 특정 범위 쏠림 가능.
- **Hash Sharding**: 해시 함수로 균등 분산. 확장/재조정 시 Rehash 비용 존재.
- **Directory/Lookup**: 메타데이터 테이블에서 샤드 매핑을 관리. 유연하지만 메타스토어가 단일 장애점이 될 수 있음.
- **Geo Sharding**: 지역별로 분리해 지연 시간을 줄임.

## 고려 사항
- **키 설계**: 단일 테넌트/사용자 단위로 묶기 쉬운 키를 선택한다.
- **크로스 샤드 질의**: 조인/집계를 줄이고, 필요 시 애플리케이션 레벨 Fan-out 전략 사용.
- **재샤딩**: 노드 추가/삭제 시 데이터를 재배치하는 온라인 마이그레이션 도구 필요.
- **일관성**: 2PC, 메시지 큐 등을 통한 분산 트랜잭션 관리가 필요할 수 있다.

## 운영 팁
- 샤드 키 변경이 어려우므로 초기에 성장 모델을 예측한다.
- 모니터링 시 샤드별 QPS, 저장 용량, 슬로우 쿼리를 개별 지표로 추적한다.
- 샤드 경계/메타정보를 `operations/publication` 에 기록해 런북화한다.
