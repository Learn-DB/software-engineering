# Transactions

## 핵심 개념
- **ACID**: Atomicity, Consistency, Isolation, Durability 네 가지 특성으로 트랜잭션의 안정성을 정의한다.
- **단위 작업**: 여러 SQL 문이 하나의 논리 작업 단위로 묶여 전부 성공하거나 전부 실패해야 한다.
- **로그 기반 복구**: WAL(write-ahead log)을 통해 트랜잭션 커밋 전에 변경사항을 로그에 기록하여 장애 발생 시 복구가 가능하다.

## 라이프사이클
1. **BEGIN/START TRANSACTION**: 연결 세션에서 트랜잭션 경계를 명시한다.
2. **작업 수행**: INSERT/UPDATE/DELETE 등 상태 변경을 수행하며 잠금, MVCC 버전을 획득한다.
3. **COMMIT**: 모든 변경이 로그에 안전하게 기록되면 영구 반영한다.
4. **ROLLBACK**: 오류나 검증 실패 시 변경을 전부 취소하고 리소스를 반환한다.

## 모범 사례
- 가능한 짧게 유지하여 잠금 경합을 줄이고, 네트워크 요청이나 사용자 입력을 기다리는 작업은 트랜잭션 밖으로 이동한다.
- 일관된 에러 핸들링 경로를 만들어 예외 발생 시 자동으로 롤백되도록 한다.
- 트랜잭션 ID(TXID)를 로깅해 문제 상황 추적을 쉽게 한다.

## 실무 체크 리스트
- 비즈니스 규칙에 따라 트랜잭션 경계를 명시적으로 지정한다 (ORM 자동 커밋 의존 X).
- 멀티 서비스/멀티 DB에 걸친 작업은 2PC, Saga 등 별도 패턴을 검토한다.
- 테스트에서 대량 동시 실행 시나리오(경합, 장애 복구)를 포함해 일관성 보장 수준을 검증한다.
